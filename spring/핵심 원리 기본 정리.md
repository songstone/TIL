## 스프링 컨테이너
- 일반적으로 ApplicationContext를 스프링 컨테이너라고 부른다
- Xml 기반, 어노테이션 기반의 자바 설정 클래스로 생성 가능
- 정확히는 beanFactory와 ApplicationContext로 구분하나 실제로 beanFactory를 직접 사용하는 경우는 거의 없다
- 빈 생성 -> 설정 정보를 참고해서 의존 관계 주입

## 빈
- 일반적으로 빈 이름은 메서드 이름을 사용
- 빈 이름 중복 x, 다른 빈이 무시되거나 기존 빈을 덮어버리거나 설정에 따라 오류가 발생

### 웹 애플리케이션과 싱글톤
- 싱글톤이 아니라면? -> 요청 시 마다 해당 객체 생성. 메모리 낭비
- 객체 하나 생성 후 공유하자
#### 싱글톤 패턴
- 클래스의 인스턴스가 딱 1개만 생성되는 것을 보장하는 디자인 패턴
- 단점
	- 코드량 증가
	- 유연성 감소
	- 테스트하기 어려움
	- 구체 클래스에 의존 -> DIP 위반

### 싱글톤 컨테이너
- 싱글톤 패턴의 단점을 해결하면서 객체를 싱글톤으로 관리 가능 하게 한다
- 빈을 싱글톤으로 관리하여 모든 요청에 하나의 객체 반환
#### 싱글톤 방식의 주의점
- 여러 클라이언트가 하나의 객체를 공유
- 무상태로 설계
	- 특정 클라이언트에 의존하는 필드가 있으면 안된다.
	- 특정 클라이언트가 값을 변경해서는 안된다.
	- 가급적 읽기만
	- 필드 대신에 자바에서 공유되지 않는 지역벼수, 파라미터, 스레드로컬 등을 사용

### @Configuration
- 스프링은 라이브러리(CGLIB)를 이용하여 바이트 코드를 조작하여 Configuration 을 래핑하여 래퍼 클래스 이용 -> 그 클래스가 싱글톤을 보장해준다.

### @ComponentScan
- @Component 가 붙은 모든 클래스를 자동으로 빈 등록
- 기본적으로 클래스의 앞글자만 소문자로 바꾼 이름으로 등록
- 이름 부여 가능
- excludeFilters : 스캔 제외 필터
- includeFilter : 스캔 포함 필터
- basePackages : 스캔 패키지 지정 하여 그 하위 패키지를 탐색
- basePackagesClasses : 지정한 클래스의 패키지의 하위를 탐색
- default는 @ComponentScan이 붙은 클래스의 패키지가 기준

### @Autowired
- 생성자에 지정시 자동으로 빈 주입
- 빈 저장소에서 기본적으로 타입 기반으로 조회하여 주입

### 빈 등록 충돌 
- 컴포넌트 스캔에 의해 동일한 이름의 빈이 등록될 시 -> ConflictingBeanDefinitionException 발생
- 수동 빈 등록과 자동 빈 등록의 이름이 겹칠 때 -> 수동 빈이 자동 빈을 오버라이딩 해버린다. -> 스프링 부트에서는 기본적으로 충돌 시 예외가 발생하도록 처리

### 의존관계 자동 주입
- 생성자 주입
	- 생성자 호출 시점에 딱 1번만 호출되는 것이 보장
	- **불변, 필수** 의존 관계에서 사용
	- 생성자가 1개만 있으면 생성자의 Autowired를 생략해도 된다.
- Setter 주입
	- setter 메서드에 @Autowired
	- **선택, 변경** 가능성이 있는 의존관계에 사용
- 필드 주입
	- 필드에 직접 @Autowired
	- 간편하지만 외부에서 변경이 불가능해 테스트가 어렵다
	- DI 프레임워크가 없으면 아무것도 할 수 없다.
	- 사용하지 말자

### 옵션 처리
- 스프링 빈이 없어도 동작 해야 할 때 사용하자
- @Autowired(required=false)
- @Nullable (param) : 생성자 주입시에도 특정 필드에 적용 가능
- Optional\<Member\> (param) 

### 동일 빈 타입 복수
- @Autowired : 타입으로 주입 시도 후 여러개면 필드명 혹은 파라미터 명으로 재주입 시도
- @Qualifier : 추가 명칭 옵션 매핑으로 지정해서 주입 가능
- @Primary : 여러개 일시 @Primary 가 붙은 Component가 우선적으로 주입

### 수동 빈 등록과 자동 빈 등록
- 업무 로직 빈 : 컨트롤러, 서비스 ,레포지토리 등 비즈니스와 밀접하게 연관
- 기술 지원 빈 : 기술적인 문제 혹은 공통 관심사 AOP처리 ex) DB 연결, 공통 로그 처리
- 가급적 업무 로직 빈은 자동으로 기술 지원 빈은 수동으로 사용하자
- 다만 다형성을 활용하는 로직에는 수동빈 등록 + 빈 목록 조회 등을 이용하자

### 빈 생명주기 콜백
- 객체의 초기화와 종료 작업 등에 활용
- 빈의 간단한 라이프 사이클 : 객체 생성 -> 의존관계 주입
- 따라서 초기화 작업은 의존관계 주입 이후에 이루어져야 한다.
- 스프링 빈 이벤트 라이프 사이클 : 스프링 컨테이너 생성 -> 스프링 빈 생성 -> 의존관계 주입 -> 초기화 콜백 -> 사용 -> 소멸전 콜백 -> 스프링 종료
- 적용 방법
	- InitializingBean, DisposableBean 인터페이스 구현
		- 코드 유연성이 떨어지므로 사용하지 말자
	- 빈 등록시 속성 값으로 initMethod, destoryMethod 메서드 명으로 지정
		- 메서드 이름이 자유롭다.
		- 빈이 스프링에 종속되지 않는다.
		- 외부 라이브러리를 빈으로 등록할 때 유용
		- 단, close, shutdown 이름을 가진 메서드는 빈이 자동으로 destroyMethod 로 지정 후 호출해준다. 사용하지 않을 때는 destoryMethod를 ""로 지정
	- @PostConstruct, @PreDestory
		- 해당 메서드에 어노테이션
		- 권장 방법
		- 스프링 종속적인 기술이 아니라 자바 표준 기술 이다
		- 외부 라이브러리 사용시에는 사용하지 못한다.